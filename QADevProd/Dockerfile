FROM node:17-alpine3.14

RUN mkdir -p /usr/src/app

WORKDIR /usr/src/app

ARG HOST
ARG NAME
ARG PASSWORD
ARG USER
ARG EMAILURL
ARG MAXAGE
ARG PORT
ARG SESSIONNAME
ARG SESSIONSECRET
ARG USERURL
ARG SNOWDEVICE
ARG SNOWURL
ARG OAUTHAPPID
ARG OAUTHAUTHORITY
ARG OAUTHAPPSECRET
ARG OAUTHREDIRECTURI
ARG CLIENTURL
ARG DOCUSIGNREDIRECTAFTERCONSENT
ARG REDIRECTUSERTOBACKENDONDOCUMENTFILLSUCCESS
ARG REDIRECTUSERFRONTENDAFTERDOCUMENTUPDATE
ARG PINGURL
ARG AZUREDOCUMENTSURL
ARG DSJWTCLIENTID
ARG IMPERSONATEDUSERGUID
ARG DOCUSIGNPRIVATEKEY
ARG DSOAUTHSERVER
ARG DOCUSIGNCCEMAIL
ARG DOCUSIGNCCFULLNAME
ARG UPLOADTOAZUREURL
ARG EDITPROFILEDOCUMENT
ARG SQLPORT
ARG MAILHOST
ARG MAILPASS
ARG SENDGRIDAPIKEY
ARG SENDGRIDDOMAINEMAIL
ARG SNOWDEVEMAIL
ARG SNOWPRODEMAIL

ENV DB_HOST $HOST
ENV DB_NAME $NAME
ENV DB_PASSWORD $PASSWORD
ENV DB_USER $USER
ENV EMAIL_URL $EMAILURL
ENV MAX_AGE $MAXAGE
ENV PORT $PORT
ENV SESSION_NAME $SESSIONNAME
ENV SESSION_SECRET $SESSIONSECRET
ENV SQL_PORT $SQLPORT
ENV MAIL_HOST $MAILHOST
ENV MAIL_PASS $MAILPASS
ENV SENDGRID_API_KEY $SENDGRIDAPIKEY
ENV SENDGRID_DOMAIN_EMAIL $SENDGRIDDOMAINEMAIL
ENV SNOW_DEV_EMAIL $SNOWDEVEMAIL
ENV SNOW_PROD_EMAIL $SNOWPRODEMAIL
ENV USER_URL $USERURL
ENV SNOW_DEVICE $SNOWDEVICE
ENV SNOW_URL $SNOWURL
ENV OAUTH_APP_ID $OAUTHAPPID
ENV OAUTH_AUTHORITY $OAUTHAUTHORITY
ENV OAUTH_APP_SECRET $OAUTHAPPSECRET
ENV OAUTH_REDIRECT_URI $OAUTHREDIRECTURI
ENV CLIENT_URL $CLIENTURL
ENV DOCUSIGN_REDIRECT_AFTER_CONSENT $DOCUSIGNREDIRECTAFTERCONSENT
ENV REDIRECT_USER_TO_BACKEND_ON_DOCUMENT_FILL_SUCCESS $REDIRECTUSERTOBACKENDONDOCUMENTFILLSUCCESS
ENV REDIRECT_USER_FRONTEND_AFTER_DOCUMENT_UPDATE $REDIRECTUSERFRONTENDAFTERDOCUMENTUPDATE
ENV PING_URL $PINGURL
ENV AZURE_DOCUMENTS_URL $AZUREDOCUMENTSURL
ENV dsJWTClientId $DSJWTCLIENTID
ENV impersonatedUserGuid $IMPERSONATEDUSERGUID
ENV DOCUSIGN-PRIVATE-KEY $DOCUSIGNPRIVATEKEY
ENV dsOauthServer $DSOAUTHSERVER
ENV DOCUSIGN_CC_EMAIL $DOCUSIGNCCEMAIL
ENV DOCUSIGN_CC_FULLNAME $DOCUSIGNCCFULLNAME
ENV UPLOAD_TO_AZURE_URL $UPLOADTOAZUREURL
ENV EDIT_PROFILE_DOCUMENT $EDITPROFILEDOCUMENT

COPY . /usr/src/app/

COPY package.json /usr/src/app/

RUN npm install 
RUN npx run build -g sequelize-cli

EXPOSE 6000

#ENTRYPOINT [ "npm", "start" ]

CMD [ "npm", "start" ]